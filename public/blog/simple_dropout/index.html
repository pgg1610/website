<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Pushkar Ghanekar | Simple Dropout using PyTorch</title>
  <meta property="og:title" content="Pushkar Ghanekar | Simple Dropout using PyTorch" />
  <meta property="og:image" content="/img/main_image.jpg" />
  <meta name="description" content="Simple uncertainity estimate using dropout in PyTorch.">
  <meta property="og:description" content="Simple uncertainity estimate using dropout in PyTorch." />
  <meta name="author" content="Pushkar Ghanekar">
  
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css"></noscript>
  
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap"></noscript>
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
      <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap"></noscript>
  <link rel="preload" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css"></noscript>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css"></noscript>
  
  <link rel="preload" href="/css/resume.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/resume.css"></noscript>
  <link rel="preload" href="/css/tweaks.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/tweaks.css"></noscript>
  <link rel="preload" href="/css/resume-override.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/resume-override.css"></noscript>
  <meta name="generator" content="Hugo 0.69.0" />
  
   
  
</head>
<body id="page-top">
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
  <a class="navbar-brand js-scroll-trigger" href="#page-top">
    <span class="d-block d-lg-none">Pushkar Ghanekar</span>
    <span class="d-none d-lg-block">
      <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="/img/main_image.jpg" alt="">
    </span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link js-scroll-trigger" href="/#about">About</a>
      </li>
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#skills">Skills</a>
          </li>
      
      
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#Publications">Publications</a>
          </li>
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#experience">Experience</a>
          </li>
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#education">Education</a>
          </li>
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="/#blog">Blog</a>
          </li>
      
    </ul>
  </div>
</nav>

  <div class="container-fluid p-0">
    
<nav aria-label="breadcrumb">
  <ol  class="breadcrumb">
    





<li class="breadcrumb-item">
  <a href="/">Home</a>
</li>


<li class="breadcrumb-item">
  <a href="/blog/">Blog</a>
</li>


<li class="breadcrumb-item active">
  <a href="/blog/simple_dropout/">Simple Dropout using PyTorch</a>
</li>

  </ol>
</nav>




<section class="resume-section p-3 p-lg-5 d-flex d-column content">
  <div class="my-auto">
    <h2 class="mb-0"><span class="text-primary">Simple Dropout using PyTorch</span></h2>
    <p><a href="https://github.com/pgg1610/misc_notebooks/blob/master/Simple_dropout.ipynb">Link to Jupyter Notebook</a></p>
    <ul>
<li>Adapted from Deep Learning online course notes from NYU. <a href="https://atcold.github.io/pytorch-Deep-Learning/en/week14/14-3/">Note link</a></li>
<li><a href="https://arxiv.org/pdf/1506.02142.pdf">Paper about using Dropout as a Bayesian Approximation</a></li>
</ul>
<p>In addition to predicting a value from a model it is also important to know the confidence in that prediction. Dropout is one way of estimating this. After multiple rounds of predictions, the mean and standard deviation in the prediction can be viewed as the prediction value and the corresponding confidence in the prediction. It is important to note that this is different from the error in the prediction. The model may have error in the prediction but could be precise in that value. It is similar to the idea of accuracy vs precision.</p>
<p>When done with dropout &ndash; the weights in the NN are scale by $\frac{1}{1-r}$ to account for dropping of the weights</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Define a simple NN </span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MLP</span>(nn<span style="color:#f92672">.</span>Module):
    <span style="color:#66d9ef">def</span> __init__(self, hidden_layers<span style="color:#f92672">=</span>[<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>], droprate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>):
        super(MLP, self)<span style="color:#f92672">.</span>__init__()
        
        self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Sequential()
        self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;input&#39;</span>, nn<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">1</span>, hidden_layers[<span style="color:#ae81ff">0</span>]))
        
        <span style="color:#66d9ef">if</span> activation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;relu&#39;</span>:
            self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;relu0&#39;</span>, nn<span style="color:#f92672">.</span>ReLU())
        
        <span style="color:#66d9ef">elif</span> activation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;tanh&#39;</span>:
            self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;tanh0&#39;</span>, nn<span style="color:#f92672">.</span>Tanh())
            
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(hidden_layers)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
            self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;dropout&#39;</span><span style="color:#f92672">+</span>str(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>), nn<span style="color:#f92672">.</span>Dropout(p<span style="color:#f92672">=</span>droprate))
            self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;hidden&#39;</span><span style="color:#f92672">+</span>str(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>), nn<span style="color:#f92672">.</span>Linear(hidden_layers[i], hidden_layers[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]))
            
            <span style="color:#66d9ef">if</span> activation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;relu&#39;</span>:
                self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;relu&#39;</span><span style="color:#f92672">+</span>str(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>), nn<span style="color:#f92672">.</span>ReLU())
                
            <span style="color:#66d9ef">elif</span> activation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;tanh&#39;</span>:
                self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;tanh&#39;</span><span style="color:#f92672">+</span>str(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>), nn<span style="color:#f92672">.</span>Tanh())
                
        self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;dropout&#39;</span><span style="color:#f92672">+</span>str(i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>), nn<span style="color:#f92672">.</span>Dropout(p<span style="color:#f92672">=</span>droprate))
        self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_module(<span style="color:#e6db74">&#39;final&#39;</span>, nn<span style="color:#f92672">.</span>Linear(hidden_layers[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">1</span>))
        
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, x):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>model(x)
</code></pre></div><p>Once a NN with a dropout implemented is instantiated, the model is called multiple times to predict the output for a given input. While doing so it is important to ensure the model is in <code>train()</code> state.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict_reg</span>(model, X, T<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>):
    
    model <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>train()
    Y_hat <span style="color:#f92672">=</span> list()
    <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
        <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> range(T):
            Y_hat<span style="color:#f92672">.</span>append(model(X<span style="color:#f92672">.</span>view(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))<span style="color:#f92672">.</span>squeeze())
    Y_hat <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>stack(Y_hat)
    
    model <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>eval()
    <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
        Y_eval <span style="color:#f92672">=</span> model(X<span style="color:#f92672">.</span>view(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))<span style="color:#f92672">.</span>squeeze()

    <span style="color:#66d9ef">return</span> Y_hat, Y_eval
</code></pre></div><p><img src="/img/simple_dropout/final_image.png" alt="final"></p>

    <p class="mt-3">
    <ul class="tags">
    
      <li><a class="tag" href="/tags/python">Python</a></li>
    
      <li><a class="tag" href="/tags/pytorch">PyTorch</a></li>
    
</ul>

    </p>
  </div>
</section>


    <span style="color: #999999; font-size: 60%;">Nifty <a href="https://codepen.io/wbeeftink/pen/dIaDH">tech tag lists</a> fromÂ <a class="pen-owner-link" href="https://codepen.io/wbeeftink">Wouter Beeftink</a> </span>
    
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
  
  <script async src="/js/resume.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-167983168-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-167983168-1');
  </script>
  

  
</body>
</html>
